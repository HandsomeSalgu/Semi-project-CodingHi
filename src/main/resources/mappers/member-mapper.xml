<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.sinuedu.user.member.model.mapper.MemberMapper">
<select id="login" resultMap="resultLogin"> SELECT * FROM USERS WHERE USER_ID = #{userId} AND STATUS = 'Y' </select>
<resultMap type="com.sinuedu.user.member.model.vo.Member" id="resultLogin">
<result column="BIRTH_DATE" property="birthDate"/>
</resultMap>
<!--  AUTO_INCREMENT 및 DEFAULT 반영: USER_NO/JOIN_DATE/ADMIN/STATUS 자동  -->
<insert id="insertMember"> INSERT INTO USERS (USER_ID, USER_PW, USER_NAME, USER_NICK, PHONE, BIRTH_DATE, HINT, HINT_ANSWER) VALUES (#{userId}, #{userPw}, #{userName}, #{userNick}, #{phone}, #{birthDate}, #{hint}, #{hintAnswer}) </insert>
<select id="checkId" resultType="_int"> SELECT COUNT(*) FROM USERS WHERE USER_ID = #{userId} </select>
<select id="checkUserNick" resultType="_int"> SELECT COUNT(*) FROM USERS WHERE USER_NICK = #{userNick} </select>
<select id="findMyId" resultType="String"> SELECT USER_ID FROM USERS WHERE USER_NAME = #{userName} AND PHONE = #{phone} AND BIRTH_DATE = #{birthDate} </select>
<resultMap type="com.sinuedu.user.member.model.vo.Member" id="findId">
<result column="BIRTH_DATE" property="birthDate"/>
</resultMap>
<update id="updateMember"> UPDATE USERS SET USER_NAME = COALESCE(#{userName}, USER_NAME), USER_NICK = COALESCE(#{userNick}, USER_NICK), USER_PW = COALESCE(#{userPw}, USER_PW), PHONE = COALESCE(#{phone}, PHONE), BIRTH_DATE = COALESCE(#{birthDate}, BIRTH_DATE), HINT = COALESCE(#{hint}, HINT), HINT_ANSWER= COALESCE(#{hintAnswer}, HINT_ANSWER) WHERE USER_ID = #{userId} </update>
<select id="findMyPw" parameterType="map"> SELECT * FROM USERS WHERE USER_ID = #{userId} AND HINT = #{hint} AND HINT_ANSWER = #{hintAnswer} </select>
<update id="updatePw" parameterType="map"> UPDATE USERS SET USER_PW = #{encodedPassword} WHERE USER_ID = #{userId} </update>
</mapper>